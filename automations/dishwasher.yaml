
# When we detect power being drawn from the dishwasher,
# mark the dishwasher as using power

  - alias: Set dishwasher active when power detected
    trigger:
      - platform: numeric_state
        entity_id: sensor.diskmaskin_strom
        above: 2
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Dirty
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Clean
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Drying
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Running
      - service: notify.pushover
        data_template:
          title: "Diskmaskinen"
          message: "Diskmaskinen har startats!"

# When the power level drops below 10, and the Dishwasher is set to
# the 'Running' state, mark the Dishwasher as Finished

  - alias: Set dishwasher drying when power drops
    trigger:
      - platform: numeric_state
        entity_id: sensor.diskmaskin_strom
        below: 2
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Running
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Drying

# Once the dishwasher status has been 'Drying' for 30 minutes, mark the
# dishwasher as clean

  - alias: Set dishwasher clean
    trigger:
      - platform: state
        entity_id: input_select.dishwasher_status
        to: Drying
        for:
          minutes: 15
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Drying
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Clean
      - service: notify.pushover
        data_template:
          title: "Diskmaskinen"
          message: "Diskmaskinen Ã¤r klar!"

# When the power drops and the dishwasher is Clean or Drying, someone has
# turned the Dishwasher off and emptied it. We should do this when the state
# of the Dishwasher is clean or Finishing, just incase someone opens the
# Dishwasher before the 30 minute timeout has been reached.

  - alias: Set Dishwasher dirty when power off
    trigger:
      - platform: numeric_state
        entity_id: sensor.diskmaskin_strom
        below: 1
    condition:
      condition: and
      conditions:
        - condition: numeric_state
          entity_id: sensor.diskmaskin_strom
          below: 1
        - condition: or
          conditions:
          - condition: state
            entity_id: input_select.dishwasher_status
            state: Clean
          - condition: state
            entity_id: input_select.dishwasher_status
            state: Drying
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.dishwasher_status
          option: Dirty
